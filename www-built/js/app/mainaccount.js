// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v1.0.4
//
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

// Backbone.BabySitter
// -------------------
// v0.0.6
//
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://github.com/babysitterjs/backbone.babysitter

// Backbone.Wreqr (Backbone.Marionette)
// ----------------------------------
// v0.2.0
//
// Copyright (c)2013 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://github.com/marionettejs/backbone.wreqr

/**
 * Backbone-relational.js 0.8.6
 * (c) 2011-2013 Paul Uithol and contributors (https://github.com/PaulUithol/Backbone-relational/graphs/contributors)
 * 
 * Backbone-relational may be freely distributed under the MIT license; see the accompanying LICENSE.txt.
 * For details and documentation: https://github.com/PaulUithol/Backbone-relational.
 * Depends on Backbone (and thus on Underscore as well): https://github.com/documentcloud/backbone.
 */

!function(e){var t=function(e){this.messages={defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",urlstrict:"This value should be a valid url.",number:"This value should be a valid number.",digits:"This value should be digits.",dateIso:"This value should be a valid date (YYYY-MM-DD).",alphanum:"This value should be alphanumeric.",phone:"This value should be a valid phone number."},notnull:"This value should not be null.",notblank:"This value should not be blank.",required:"This value is required.",regexp:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or less.",rangelength:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or less.",rangecheck:"You must select between %s and %s choices.",equalto:"This value should be the same."},this.init(e)};t.prototype={constructor:t,validators:{notnull:function(e){return e.length>0},notblank:function(e){return"string"==typeof e&&""!==e.replace(/^\s+/g,"").replace(/\s+$/g,"")},required:function(e){if("object"==typeof e){for(var t in e)if(this.required(e[t]))return!0;return!1}return this.notnull(e)&&this.notblank(e)},type:function(e,t){var n;switch(t){case"number":n=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":n=/^\d+$/;break;case"alphanum":n=/^\w+$/;break;case"email":n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))){2,6}$/i;break;case"url":e=(new RegExp("(https?|s?ftp|git)","i")).test(e)?e:"http://"+e;case"urlstrict":n=/^(https?|s?ftp|git):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"dateIso":n=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":n=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return""!==e?n.test(e):!1},regexp:function(e,t,n){return(new RegExp(t,n.options.regexpFlag||"")).test(e)},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t},rangelength:function(e,t){return this.minlength(e,t[0])&&this.maxlength(e,t[1])},min:function(e,t){return Number(e)>=t},max:function(e,t){return Number(e)<=t},range:function(e,t){return e>=t[0]&&e<=t[1]},equalto:function(t,n,r){return r.options.validateIfUnchanged=!0,t===e(n).val()},remote:function(t,n,r){var i=null,s={},o={};s[r.$element.attr("name")]=t,"undefined"!=typeof r.options.remoteDatatype&&(o={dataType:r.options.remoteDatatype});var u=function(t,n){"undefined"!=typeof n&&"undefined"!=typeof r.Validator.messages.remote&&n!==r.Validator.messages.remote&&e(r.ulError+" .remote").remove(),r.updtConstraint({name:"remote",valid:t},n),r.manageValidationResult()},a=function(t){if("object"==typeof t)return t;try{t=e.parseJSON(t)}catch(n){}return t},f=function(e){return"object"==typeof e&&null!==e?"undefined"!=typeof e.error?e.error:"undefined"!=typeof e.message?e.message:null:null};return e.ajax(e.extend({},{url:n,data:s,type:r.options.remoteMethod||"GET",success:function(e){e=a(e),u(1===e||!0===e||"object"==typeof e&&null!==e&&"undefined"!=typeof e.success,f(e))},error:function(e){e=a(e),u(!1,f(e))}},o)),i},mincheck:function(e,t){return this.minlength(e,t)},maxcheck:function(e,t){return this.maxlength(e,t)},rangecheck:function(e,t){return this.rangelength(e,t)}},init:function(e){var t=e.validators,n=e.messages,r;for(r in t)this.addValidator(r,t[r]);for(r in n)this.addMessage(r,n[r])},formatMesssage:function(e,t){if("object"==typeof t){for(var n in t)e=this.formatMesssage(e,t[n]);return e}return"string"==typeof e?e.replace(new RegExp("%s","i"),t):""},addValidator:function(e,t){this.validators[e]=t},addMessage:function(e,t,n){if("undefined"!=typeof n&&!0===n){this.messages.type[e]=t;return}if("type"===e){for(var r in t)this.messages.type[r]=t[r];return}this.messages[e]=t}};var n=function(e,n,r){this.options=n,this.Validator=new t(n);if(r==="ParsleyFieldMultiple")return this;this.init(e,r||"ParsleyField")};n.prototype={constructor:n,init:function(t,n){this.type=n,this.valid=!0,this.element=t,this.validatedOnce=!1,this.$element=e(t),this.val=this.$element.val(),this.isRequired=!1,this.constraints={},"undefined"==typeof this.isRadioOrCheckbox&&(this.isRadioOrCheckbox=!1,this.hash=this.generateHash(),this.errorClassHandler=this.options.errors.classHandler(t,this.isRadioOrCheckbox)||this.$element),this.ulErrorManagement(),this.bindHtml5Constraints(),this.addConstraints(),this.hasConstraints()&&this.bindValidationEvents()},setParent:function(t){this.$parent=e(t)},getParent:function(){return this.$parent},bindHtml5Constraints:function(){if(this.$element.hasClass("required")||this.$element.prop("required"))this.options.required=!0;"undefined"!=typeof this.$element.attr("type")&&(new RegExp(this.$element.attr("type"),"i")).test("email url number range")&&(this.options.type=this.$element.attr("type"),(new RegExp(this.options.type,"i")).test("number range")&&(this.options.type="number","undefined"!=typeof this.$element.attr("min")&&this.$element.attr("min").length&&(this.options.min=this.$element.attr("min")),"undefined"!=typeof this.$element.attr("max")&&this.$element.attr("max").length&&(this.options.max=this.$element.attr("max")))),"string"==typeof this.$element.attr("pattern")&&this.$element.attr("pattern").length&&(this.options.regexp=this.$element.attr("pattern"))},addConstraints:function(){for(var e in this.options){var t={};t[e]=this.options[e],this.addConstraint(t,!0)}},addConstraint:function(e,t){for(var n in e)n=n.toLowerCase(),"function"==typeof this.Validator.validators[n]&&(this.constraints[n]={name:n,requirements:e[n],valid:null},n==="required"&&(this.isRequired=!0),this.addCustomConstraintMessage(n));"undefined"==typeof t&&this.bindValidationEvents()},updateConstraint:function(e,t){for(var n in e)this.updtConstraint({name:n,requirements:e[n],valid:null},t)},updtConstraint:function(t,n){this.constraints[t.name]=e.extend(!0,this.constraints[t.name],t),"string"==typeof n&&(this.Validator.messages[t.name]=n),this.bindValidationEvents()},removeConstraint:function(e){var e=e.toLowerCase();delete this.constraints[e],e==="required"&&(this.isRequired=!1);if(!this.hasConstraints()){if("ParsleyForm"==typeof this.getParent()){this.getParent().removeItem(this.$element);return}this.destroy();return}this.bindValidationEvents()},addCustomConstraintMessage:function(e){var t=e+("type"===e&&"undefined"!=typeof this.options[e]?this.options[e].charAt(0).toUpperCase()+this.options[e].substr(1):"")+"Message";"undefined"!=typeof this.options[t]&&this.Validator.addMessage("type"===e?this.options[e]:e,this.options[t],"type"===e)},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type),this.options.remote&&!(new RegExp("change","i")).test(this.options.trigger)&&(this.options.trigger=this.options.trigger?" change":"change");var t=(this.options.trigger?this.options.trigger:"")+((new RegExp("key","i")).test(this.options.trigger)?"":" keyup");this.$element.is("select")&&(t+=(new RegExp("change","i")).test(t)?"":" change"),t=t.replace(/^\s+/g,"").replace(/\s+$/g,""),this.$element.on((t+" ").split(" ").join("."+this.type+" "),!1,e.proxy(this.eventValidation,this))},generateHash:function(){return"parsley-"+(Math.random()+"").substring(2)},getHash:function(){return this.hash},getVal:function(){return this.$element.data("value")||this.$element.val()},eventValidation:function(e){var t=this.getVal();if(e.type==="keyup"&&!/keyup/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(e.type==="change"&&!/change/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(!this.isRadioOrCheckbox&&this.getLength(t)<this.options.validationMinlength&&!this.validatedOnce)return!0;this.validate()},getLength:function(e){return!e||!e.hasOwnProperty("length")?0:e.length},isValid:function(){return this.validate(!1)},hasConstraints:function(){for(var e in this.constraints)return!0;return!1},validate:function(e){var t=this.getVal(),n=null;return this.hasConstraints()?this.options.listeners.onFieldValidate(this.element,this)||""===t&&!this.isRequired?(this.reset(),null):this.needsValidation(t)?(n=this.applyValidators(),("undefined"!=typeof e?e:this.options.showErrors)&&this.manageValidationResult(),n):this.valid:null},needsValidation:function(e){return!this.options.validateIfUnchanged&&this.valid!==null&&this.val===e&&this.validatedOnce?!1:(this.val=e,this.validatedOnce=!0)},applyValidators:function(){var e=null;for(var t in this.constraints){var n=this.Validator.validators[this.constraints[t].name](this.val,this.constraints[t].requirements,this);!1===n?(e=!1,this.constraints[t].valid=e,this.options.listeners.onFieldError(this.element,this.constraints,this)):!0===n&&(this.constraints[t].valid=!0,e=!1!==e,!1===this.options.listeners.onFieldSuccess(this.element,this.constraints,this)&&(e=!1))}return e},manageValidationResult:function(){var t=null;for(var n in this.constraints)!1===this.constraints[n].valid?(this.manageError(this.constraints[n]),t=!1):!0===this.constraints[n].valid&&(this.removeError(this.constraints[n].name),t=!1!==t);return this.valid=t,!0===this.valid?(this.removeErrors(),this.errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass),!0):!1===this.valid?(this.errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass),!1):(this.ulError&&e(this.ulError).children().length===0&&this.removeErrors(),t)},ulErrorManagement:function(){this.ulError="#"+this.hash,this.ulTemplate=e(this.options.errors.errorsWrapper).attr("id",this.hash).addClass("parsley-error-list")},removeError:function(t){var n=this.ulError+" ."+t,r=this;this.options.animate?e(n).fadeOut(this.options.animateDuration,function(){e(this).remove(),r.ulError&&e(r.ulError).children().length===0&&r.removeErrors()}):e(n).remove()},addError:function(t){for(var n in t){var r=e(this.options.errors.errorElem).addClass(n);e(this.ulError).append(this.options.animate?e(r).html(t[n]).hide().fadeIn(this.options.animateDuration):e(r).html(t[n]))}},removeErrors:function(){this.options.animate?e(this.ulError).fadeOut(this.options.animateDuration,function(){e(this).remove()}):e(this.ulError).remove()},reset:function(){this.valid=null,this.removeErrors(),this.validatedOnce=!1,this.errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass);for(var e in this.constraints)this.constraints[e].valid=null;return this},manageError:function(t){e(this.ulError).length||this.manageErrorContainer();if("required"===t.name&&null!==this.getVal()&&this.getVal().length>0)return;if(!(!this.isRequired||"required"===t.name||null!==this.getVal()&&0!==this.getVal().length))return;var n=t.name,r=!1!==this.options.errorMessage?"custom-error-message":n,i={},s=!1!==this.options.errorMessage?this.options.errorMessage:t.name==="type"?this.Validator.messages[n][t.requirements]:"undefined"==typeof this.Validator.messages[n]?this.Validator.messages.defaultMessage:this.Validator.formatMesssage(this.Validator.messages[n],t.requirements);e(this.ulError+" ."+r).length||(i[r]=s,this.addError(i))},manageErrorContainer:function(){var t=this.options.errorContainer||this.options.errors.container(this.element,this.isRadioOrCheckbox),n=this.options.animate?this.ulTemplate.show():this.ulTemplate;if("undefined"!=typeof t){e(t).append(n);return}this.isRadioOrCheckbox?this.$element.parent().after(n):this.$element.after(n)},addListener:function(e){for(var t in e)this.options.listeners[t]=e[t]},destroy:function(){this.$element.removeClass("parsley-validated"),this.reset().$element.off("."+this.type).removeData(this.type)}};var r=function(e,n,r){this.initMultiple(e,n),this.inherit(e,n),this.Validator=new t(n),this.init(e,r||"ParsleyFieldMultiple")};r.prototype={constructor:r,initMultiple:function(t,n){this.element=t,this.$element=e(t),this.group=n.group||!1,this.hash=this.getName(),this.siblings=this.group?'[data-group="'+this.group+'"]':'input[name="'+this.$element.attr("name")+'"]',this.isRadioOrCheckbox=!0,this.isRadio=this.$element.is("input[type=radio]"),this.isCheckbox=this.$element.is("input[type=checkbox]"),this.errorClassHandler=n.errors.classHandler(t,this.isRadioOrCheckbox)||this.$element.parent()},inherit:function(e,t){var r=new n(e,t,"ParsleyFieldMultiple");for(var i in r)"undefined"==typeof this[i]&&(this[i]=r[i])},getName:function(){if(this.group)return"parsley-"+this.group;if("undefined"==typeof this.$element.attr("name"))throw"A radio / checkbox input must have a data-group attribute or a name to be Parsley validated !";return"parsley-"+this.$element.attr("name").replace(/(:|\.|\[|\])/g,"")},getVal:function(){if(this.isRadio)return e(this.siblings+":checked").val()||"";if(this.isCheckbox){var t=[];return e(this.siblings+":checked").each(function(){t.push(e(this).val())}),t}},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type);var t=this,n=(this.options.trigger?this.options.trigger:"")+((new RegExp("change","i")).test(this.options.trigger)?"":" change");n=n.replace(/^\s+/g,"").replace(/\s+$/g,""),e(this.siblings).each(function(){e(this).on(n.split(" ").join("."+t.type+" "),!1,e.proxy(t.eventValidation,t))})}};var i=function(e,t,n){this.init(e,t,n||"parsleyForm")};i.prototype={constructor:i,init:function(t,n,r){this.type=r,this.items=[],this.$element=e(t),this.options=n;var i=this;this.$element.find(n.inputs).each(function(){i.addItem(this)}),this.$element.on("submit."+this.type,!1,e.proxy(this.validate,this))},addListener:function(e){for(var t in e)if((new RegExp("Field")).test(t))for(var n=0;n<this.items.length;n++)this.items[n].addListener(e);else this.options.listeners[t]=e[t]},addItem:function(t){if(e(t).is(this.options.excluded))return!1;var n=e(t).parsley(this.options);n.setParent(this),this.items.push(n)},removeItem:function(t){var n=e(t).parsley();for(var r=0;r<this.items.length;r++)if(this.items[r].hash===n.hash)return this.items[r].destroy(),this.items.splice(r,1),!0;return!1},validate:function(e){var t=!0;this.focusedField=!1;for(var n=0;n<this.items.length;n++)if("undefined"!=typeof this.items[n]&&!1===this.items[n].validate()){t=!1;if(!this.focusedField&&"first"===this.options.focus||"last"===this.options.focus)this.focusedField=this.items[n].$element}this.focusedField&&!t&&this.focusedField.focus();var r=this.options.listeners.onFormSubmit(t,e,this);return"undefined"!=typeof r?r:t},isValid:function(){for(var e=0;e<this.items.length;e++)if(!1===this.items[e].isValid())return!1;return!0},removeErrors:function(){for(var e=0;e<this.items.length;e++)this.items[e].parsley("reset")},destroy:function(){for(var e=0;e<this.items.length;e++)this.items[e].destroy();this.$element.off("."+this.type).removeData(this.type)},reset:function(){for(var e=0;e<this.items.length;e++)this.items[e].reset()}},e.fn.parsley=function(t,s){function a(u,a){var f=e(u).data(a);if(!f){switch(a){case"parsleyForm":f=new i(u,o,"parsleyForm");break;case"parsleyField":f=new n(u,o,"parsleyField");break;case"parsleyFieldMultiple":f=new r(u,o,"parsleyFieldMultiple");break;default:return}e(u).data(a,f)}if("string"==typeof t&&"function"==typeof f[t]){var l=f[t](s);return"undefined"!=typeof l?l:e(u)}return f}var o=e.extend(!0,{},e.fn.parsley.defaults,"undefined"!=typeof window.ParsleyConfig?window.ParsleyConfig:{},t,this.data()),u=null;return e(this).is("form")||!0===e(this).data("bind")?u=a(e(this),"parsleyForm"):e(this).is(o.inputs)&&!e(this).is(o.excluded)&&(u=a(e(this),e(this).is("input[type=radio], input[type=checkbox]")?"parsleyFieldMultiple":"parsleyField")),"function"==typeof s?s():u},e.fn.parsley.Constructor=i,e.fn.parsley.defaults={inputs:"input, textarea, select",excluded:"input[type=hidden], input[type=file], :disabled",trigger:!1,animate:!0,animateDuration:300,focus:"first",validationMinlength:3,successClass:"parsley-success",errorClass:"parsley-error",errorMessage:!1,validators:{},showErrors:!0,messages:{},validateIfUnchanged:!1,errors:{classHandler:function(e,t){},container:function(e,t){},errorsWrapper:"<ul></ul>",errorElem:"<li></li>"},listeners:{onFieldValidate:function(e,t){return!1},onFormSubmit:function(e,t,n){},onFieldError:function(e,t,n){},onFieldSuccess:function(e,t,n){}}},e(window).on("load",function(){e('[data-validate="parsley"]').each(function(){e(this).parsley()})})}(window.jQuery||window.Zepto),define("parsley",["jquery"],function(e){return function(){var t,n;return t||e.parsley}}(this)),define("views/account/main_container_view",["backbone","handlebars"],function(e,t){var n=e.View.extend({el:"#mainContainer",initialize:function(e){this.router=e.router},events:{"click .nav_menu":"triggerNavigate"},triggerNavigate:function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute("href");this.router.navigate(t,{trigger:!0})},switchToView:function(e){e.delegateEvents(),this.$("#contentWrapper").empty().append(e.$el)},switchTab:function(e){$(".nav_menu").removeClass("current"),e[0].setAttribute("class","current nav_menu sub_navigation_tab")}});return n}),define("text!templates/account/personal.html",[],function(){return'\n<h2>Personal Details</h2>\n<div class="notification_container account_notification_container hide"><p class="notification_text personal_saved"><i class="fa fa-check"></i>Personal details saved<p></div>\n<form action="" method="get" accept-charset="utf-8" class="account_personal_form">\n  <fieldset>\n    <label for="">First Name<span class="required">*</span></label>\n    <input data-required="true" type="text" name="firstName" placeholder="Your first name" id="" size="50" value="{{firstName}}">\n    <label for="">Last Name<span class="required">*</span></label>\n    <input data-required="true" type="text" name="lastName" placeholder="You last name" id="" size="50" value="{{lastName}}">\n    <label for="">Photo</label>\n    <input type="file" name="avatarData" class="upload">\n    <label for="">Email</label>\n    <input type="text" name="email" placeholder="email@domain.com" id="" size="50" value="{{email}}">\n    <label for="">Phone Number</label>\n    <input type="text" name="phoneNumber" placeholder="(480) 329-7537" id="" size="50" value="{{phoneFormat phoneNumber}}">\n  </fieldset>\n  <fieldset class="submit-buttons">\n    <a id="save-button" class="single">Save Personal Details</a>\n  </fieldset>\n</form>'}),define("text!templates/account/profile_preview.html",[],function(){return'<h2>Profile Preview</h2>\n<div class="data-table">\n  <table border="0" cellspacing="0" cellpadding="0">\n    <tr>\n      <td class="meta">\n        <span><img src="{{#if avatarData}}{{avatarData}}{{else}}{{avatarURL}}{{/if}}"></span>\n      </td>\n      <td>\n        <h3><a href="detail.html">{{firstName}} {{lastName}}</a></h3>\n        <p>{{email}} &mdash; {{phoneFormat phoneNumber}}</p>\n      </td>\n    </tr>\n  </table>\n</div>'}),define("views/account/personal_view",["backbone","handlebars","text!templates/account/personal.html","text!templates/account/profile_preview.html"],function(e,t,n,r){t.registerHelper("phoneFormat",function(e){if(!e)return;var t=e.substring(0,3),n=e.substring(3,6),r=e.substring(6,10);return"("+t+") "+n+"-"+r});var i=e.View.extend({template:t.compile(r),initialize:function(){this.listenTo(this.model,"change",this.render),this.render()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),s=e.View.extend({className:"clear white_background",attributes:{id:"content"},template:t.compile(n),events:{'blur input[type="text"]':"updateFields",'change input[type="file"]':"updateFile","click #save-button":"save",'blur input[name="phoneNumber"]':"updatePhoneNumber"},initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=new i({model:this.model});return this.$el.prepend(e.$el),this},updateFields:function(e){this.model.set(e.target.name,e.target.value),this.updatenotification()},updateFile:function(e){var t=e.target;if(t.files&&t.files[0]){var n=this,r=new FileReader;r.onload=function(t){n.model.set(e.target.name,t.target.result),console.log(n.model),n.updateSaveButton()},r.readAsDataURL(t.files[0])}},updatePhoneNumber:function(e){var t=e.target.value;this.model.set("phoneNumber",t.replace(/[^0-9]/g,""))},updatenotification:function(e){$(".notification_container").fadeOut("slow")},save:function(){$(".account_personal_form").parsley("validate");var e=$(".account_personal_form").parsley("isValid");e&&this.model.save({},{success:_.bind(function(e,t){$(".notification_container").fadeOut("fast").fadeIn("slow")},this)})}});return s}),Backbone.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength()},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength()},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(r){t.isFunction(r[e])&&r[e].apply(r,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(Backbone,_),Backbone.Wreqr=function(e,t,n){var r={};return r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)throw new Error("Handler not found for '"+e+"'");return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,n),r.CommandStorage=function(){var t=function(e){this.options=e,this._commands={},n.isFunction(this.initialize)&&this.initialize(e)};return n.extend(t.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),t}(),r.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var n=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,n)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,t,r){var i=this.storage.getCommands(e);n.each(i.instances,function(e){t.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var t,r=e.storageType||this.storageType;n.isFunction(r)?t=new r:t=r,this.storage=t}})}(r),r.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.getHandler(e).apply(this,t)}})}(r),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,n),r}(Backbone,Backbone.Marionette,_);var Marionette=function(e,t,n){function s(e){return i.call(e)}function o(e,t){var n=new Error(e);throw n.name=t||"Error",n}var r={};t.Marionette=r,r.$=t.$;var i=Array.prototype.slice;return r.extend=t.Model.extend,r.getOption=function(e,t){if(!e||!t)return;var n;return e.options&&t in e.options&&e.options[t]!==undefined?n=e.options[t]:n=e[t],n},r.triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi,r=function(r){var i="on"+r.replace(e,t),s=this[i];this.trigger.apply(this,arguments);if(n.isFunction(s))return s.apply(this,n.tail(arguments))};return r}(),r.MonitorDOMRefresh=function(){function e(e){e._isShown=!0,r(e)}function t(e){e._isRendered=!0,r(e)}function r(e){e._isShown&&e._isRendered&&n.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}return function(n){n.listenTo(n,"show",function(){e(n)}),n.listenTo(n,"render",function(){t(n)})}}(),function(e){function t(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];i||o("Method '"+n+"' was configured as an event handler, but does not exist."),e.listenTo(t,r,i,e)})}function r(e,t,n,r){e.listenTo(t,n,r,e)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i,e)})}function s(e,t,n,r){e.stopListening(t,n,r,e)}function u(e,t,r,i,s){if(!t||!r)return;n.isFunction(r)&&(r=r.call(e)),n.each(r,function(r,o){n.isFunction(r)?i(e,t,o,r):s(e,t,o,r)})}e.bindEntityEvents=function(e,n,i){u(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){u(e,t,n,s,i)}}(r),r.Callbacks=function(){this._deferred=r.$.Deferred(),this._callbacks=[]},n.extend(r.Callbacks.prototype,{add:function(e,t){this._callbacks.push({cb:e,ctx:t}),this._deferred.done(function(n,r){t&&(n=t),e.call(n,r)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=r.$.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),r.Controller=function(e){this.triggerMethod=r.triggerMethod,this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,n.extend(r.Controller.prototype,t.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),r.Region=function(e){this.options=e||{},this.el=r.getOption(this,"el");if(!this.el){var t=new Error("An 'el' must be specified for a region.");throw t.name="NoElError",t}if(this.initialize){var n=Array.prototype.slice.apply(arguments);this.initialize.apply(this,n)}},n.extend(r.Region,{buildRegion:function(e,t){var r=typeof e=="string",i=typeof e.selector=="string",s=typeof e.regionType=="undefined",o=typeof e=="function";if(!o&&!r&&!i)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var u,a;r&&(u=e),e.selector&&(u=e.selector),o&&(a=e),!o&&s&&(a=t),e.regionType&&(a=e.regionType);var f=new a({el:u});return e.parentEl&&(f.getEl=function(t){var r=e.parentEl;return n.isFunction(r)&&(r=r()),r.find(t)}),f}}),n.extend(r.Region.prototype,t.Events,{show:function(e){this.ensureEl();var t=e.isClosed||n.isUndefined(e.$el),i=e!==this.currentView;i&&this.close(),e.render(),(i||t)&&this.open(e),this.currentView=e,r.triggerMethod.call(this,"show",e),r.triggerMethod.call(e,"show")},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return r.$(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;if(!e||e.isClosed)return;e.close?e.close():e.remove&&e.remove(),r.triggerMethod.call(this,"close"),delete this.currentView},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),r.Region.extend=r.extend,r.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.prototype.constructor.call(this,t)},addRegions:function(e,t){var r={};return n.each(e,function(e,i){typeof e=="string"&&(e={selector:e}),e.selector&&(e=n.defaults({},e,t));var s=this.addRegion(i,e);r[i]=s},this),r},addRegion:function(t,r){var i,s=n.isObject(r),o=n.isString(r),u=!!r.selector;return o||s&&u?i=e.Region.buildRegion(r,e.Region):n.isFunction(r)?i=e.Region.buildRegion(r,e.Region):i=r,this._store(t,i),this.triggerMethod("region:add",t,i),i},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){n.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){n.each(this._regions,function(e,t){e.close()},this)},close:function(){this.removeRegions();var t=Array.prototype.slice.call(arguments);e.Controller.prototype.close.apply(this,t)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){t.close(),delete this._regions[e],this._setLength(),this.triggerMethod("region:remove",e,t)},_setLength:function(){this.length=n.size(this._regions)}}),r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return n.each(r,function(e){t.prototype[e]=function(){var t=n.values(this._regions),r=[t].concat(n.toArray(arguments));return n[e].apply(n,r)}}),t}(r),r.TemplateCache=function(e){this.templateId=e},n.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new r.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=s(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(r.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=r.$(e).html();return(!t||t.length===0)&&o("Could not find template: '"+e+"'","NoTemplateError"),t},compileTemplate:function(e){return n.template(e)}}),r.Renderer={render:function(e,t){if(!e){var n=new Error("Cannot render the template since it's false, null or undefined.");throw n.name="TemplateNotFoundError",n}var i;return typeof e=="function"?i=e:i=r.TemplateCache.get(e),i(t)}},r.View=t.View.extend({constructor:function(){n.bindAll(this,"render");var e=Array.prototype.slice.apply(arguments);t.View.prototype.constructor.apply(this,e),r.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:r.triggerMethod,getTemplate:function(){return r.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=this.templateHelpers;return n.isFunction(t)&&(t=t.call(this)),n.extend(e,t)},configureTriggers:function(){if(!this.triggers)return;var e={},t=n.result(this,"triggers");return n.each(t,function(t,n){e[n]=function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var n={view:this,model:this.model,collection:this.collection};this.triggerMethod(t,n)}},this),e},delegateEvents:function(e){this._delegateDOMEvents(e),r.bindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.bindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,n.isFunction(e)&&(e=e.call(this));var r={},i=this.configureTriggers();n.extend(r,e,i),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);t.View.prototype.undelegateEvents.apply(this,e),r.unbindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.unbindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(this.isClosed)return;var e=this.triggerMethod("before:close");if(e===!1)return;this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove()},bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(n.keys(e),function(t){var n=e[t];this.ui[t]=this.$(n)},this)},unbindUIElements:function(){if(!this.ui)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings}}),r.ItemView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,s(arguments))},serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),n=r.Renderer.render(t,e);return this.$el.html(n),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){if(this.isClosed)return;this.triggerMethod("item:before:close"),r.View.prototype.close.apply(this,s(arguments)),this.triggerMethod("item:closed")}}),r.CollectionView=r.View.extend({itemViewEventPrefix:"itemview",constructor:function(e){this._initChildViewStorage(),r.View.prototype.constructor.apply(this,s(arguments)),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(e,t,n){this.closeEmptyView();var r=this.getItemView(e),i=this.collection.indexOf(e);this.addItemView(e,r,i)},onShowCalled:function(){this.children.each(function(e){r.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var e;this.collection.each(function(t,n){e=this.getItemView(t),this.addItemView(t,e,n)},this)},showEmptyView:function(){var e=r.getOption(this,"emptyView");if(e&&!this._showingEmptyView){this._showingEmptyView=!0;var n=new t.Model;this.addItemView(n,e,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(e){var t=r.getOption(this,"itemView");return t||o("An `itemView` must be specified","NoItemViewError"),t},addItemView:function(e,t,i){var s=r.getOption(this,"itemViewOptions");n.isFunction(s)&&(s=s.call(this,e,i));var o=this.buildItemView(e,t,s);this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,i),this._isShown&&r.triggerMethod.call(o,"show"),this.triggerMethod("after:item:added",o)},addChildViewEventForwarding:function(e){var t=r.getOption(this,"itemViewEventPrefix");this.listenTo(e,"all",function(){var n=s(arguments);n[0]=t+":"+n[0],n.splice(1,0,e),r.triggerMethod.apply(this,n)},this)},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,t,r){var i=n.extend({model:e},r);return new t(i)},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(this.stopListening(e),e.close?e.close():e.remove&&e.remove(),this.children.remove(e)),this.triggerMethod("item:removed",e)},checkEmpty:function(){(!this.collection||this.collection.length===0)&&this.showEmptyView()},appendHtml:function(e,t,n){e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},close:function(){if(this.isClosed)return;this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),r.View.prototype.close.apply(this,s(arguments))},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),r.CompositeView=r.CollectionView.extend({constructor:function(){r.CollectionView.prototype.constructor.apply(this,s(arguments))},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))},getItemView:function(e){var t=r.getOption(this,"itemView")||this.constructor;return t||o("An `itemView` must be specified","NoItemViewError"),t},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(r.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return r.Renderer.render(t,e)},appendHtml:function(e,t,n){var r=this.getItemViewContainer(e);r.append(t.el)},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var t;if(e.itemViewContainer){var r=n.result(e,"itemViewContainer");t=e.$(r),t.length<=0&&o("The specified `itemViewContainer` was not found: "+e.itemViewContainer,"ItemViewContainerMissingError")}else t=e.$el;return e.$itemViewContainer=t,t},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),r.Layout=r.ItemView.extend({regionType:r.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),r.ItemView.prototype.constructor.call(this,e)},render:function(){this._firstRender?this._firstRender=!1:this.isClosed?this._initializeRegions():this._reInitializeRegions();var e=Array.prototype.slice.apply(arguments),t=r.ItemView.prototype.render.apply(this,e);return t},close:function(){if(this.isClosed)return;this.regionManager.close();var e=Array.prototype.slice.apply(arguments);r.ItemView.prototype.close.apply(this,e)},addRegion:function(e,t){var n={};return n[e]=t,this.addRegions(n)[e]},addRegions:function(e){return this.regions=n.extend(this.regions||{},e),this._buildRegions(e)},removeRegion:function(e){return this.regionManager.removeRegion(e)},_buildRegions:function(e){var t=this,n={parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,n)},_initializeRegions:function(e){var t;this._initRegionManager(),n.isFunction(this.regions)?t=this.regions(e):t=this.regions||{},this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new r.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),r.AppRouter=t.Router.extend({constructor:function(e){t.Router.prototype.constructor.apply(this,s(arguments)),this.options=e;if(this.appRoutes){var n=r.getOption(this,"controller");this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,t){var r=n.keys(t).reverse();n.each(r,function(r){var i=t[r],s=e[i];if(!s)throw new Error("Method '"+i+"' was not found on the controller");this.route(r,i,n.bind(s,e))},this)}}),r.Application=function(e){this._initRegionManager(),this._initCallbacks=new r.Callbacks,this.vent=new t.Wreqr.EventAggregator,this.commands=new t.Wreqr.Commands,this.reqres=new t.Wreqr.RequestResponse,this.submodules={},n.extend(this,e),this.triggerMethod=r.triggerMethod},n.extend(r.Application.prototype,t.Events,{execute:function(){var e=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,e)},request:function(){var e=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,e)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},removeRegion:function(e){this._regionManager.removeRegion(e)},module:function(e,t){var n=s(arguments);return n.unshift(this),r.Module.create.apply(r.Module,n)},_initRegionManager:function(){this._regionManager=new r.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e,t){delete this[e]})}}),r.Application.extend=r.extend,r.Module=function(e,t){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=r.triggerMethod},n.extend(r.Module.prototype,t.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,r.triggerMethod.call(this,"before:stop"),n.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),r.triggerMethod.call(this,"stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,i){if(!e)return;var s=n.flatten([this,this.app,t,r,r.$,n,i]);e.apply(this,s)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks}}),n.extend(r.Module,{create:function(e,t,r){var i=e,o=s(arguments);o.splice(0,3),t=t.split(".");var u=t.length,a=[];return a[u-1]=r,n.each(t,function(t,n){var r=i;i=this._getModule(r,t,e),this._addModuleDefinition(r,i,a[n],o)},this),i},_getModule:function(e,t,n,i,s){var o=e[t];return o||(o=new r.Module(t,n),e[t]=o,e.submodules[t]=o),o},_addModuleDefinition:function(e,t,r,i){var s,o;n.isFunction(r)?(s=r,o=!0):n.isObject(r)?(s=r.define,o=r.startWithParent):o=!0,s&&t.addDefinition(s,i),t.startWithParent=t.startWithParent&&o,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),r}(this,Backbone,_);define("marionette",["jquery","underscore","backbone"],function(e){return function(){var t,n;return t||e.Marionette}}(this)),define("text!templates/account/creditcard_layout.html",[],function(){return'<div id="stored-cards" class="stored_payment_methods"></div>\n<div id="new-card"></div>\n</div>'}),define("text!templates/account/new_card_tpl.html",[],function(){return'<div class="notification_container account_notification_container hide"><p class="notification_text credit_card_saved"><i class="fa fa-check"></i> Credit card saved<p></div>\n<h2>Credit Card Details</h2>\n<img class="account_secure" src="/img/balanced_secured.png">\n<form action="" method="get" accept-charset="utf-8"class="very_secure">\n  <fieldset>\n    <label for="">Credit Card Number</label>\n    <input type="text" name="card_number" value="" id="" size="50">\n    <label for="">Expires On</label>\n    <select name="expiration_month" id="">\n      <option value="1">1</option>\n      <option value="2">2</option>\n      <option value="3">3</option>\n      <option value="4">4</option>\n      <option value="5">5</option>\n      <option value="6">6</option>\n      <option value="7">7</option>\n      <option value="8">8</option>\n      <option value="9">9</option>\n      <option value="10">10</option>\n      <option value="11">11</option>\n      <option value="12">12</option>\n    </select>\n    <select name="expiration_year" id="">\n      <option value="2013">2013</option>\n      <option value="2014">2014</option>\n      <option value="2015">2015</option>\n      <option value="2016">2016</option>\n      <option value="2017">2017</option>\n      <option value="2018">2018</option>\n      <option value="2019">2019</option>\n      <option value="2020">2020</option>\n      <option value="2021">2021</option>\n    </select>\n    <label for="">Billing Address Zip/Postal Code</label>\n    <input type="text" name="postal_code" value="" id="" size="25">\n    <label for="">Security Code</label>\n    <input type="text" name="security_code" value="" id="" size="25">\n  </fieldset>\n  <fieldset class="submit-buttons">\n    <a id="save-button" class="single">Save Credit Card Details</a>\n  </fieldset>\n</form>'}),define("views/account/new_card_view",["jquery","backbone","handlebars","text!templates/account/new_card_tpl.html"],function(e,t,n,r){var i=t.View.extend({template:n.compile(r),events:{"blur input":"updateFields","click #save-button":"saveCard","change select":"updateFields"},initialize:function(e){this.render(),this.card={expiration_month:1,expiration_year:2013},this.user=e.user,console.log(this.user)},render:function(){return this.$el.html(this.template()),this},updateFields:function(t){this.card[t.target.name]=t.target.value,e(".notification_container").fadeOut("slow")},saveCard:function(t){var n=this;balanced.card.create(this.card,function(t){if(t.status===201){delete t.data.id,console.log(t);var r=new n.user.attributes.cards.model(t.data);console.log(_.clone(r)),n.user.get("cards").add(r),console.log(n.user.get("cards")),r.save(),e("input").val(""),e(".notification_container").fadeOut("fast").fadeIn("slow")}else console.log(t)})}});return i}),define("text!templates/account/stored_card_item.html",[],function(){return'<td>\n  <h3>**** **** **** {{last_four}}</h3>\n  <p>Expires: {{expiration_month}}/{{expiration_year}}</p>\n  <p class="remove"><a >Delete Credit Card</a></p>\n</td>'}),define("text!templates/account/stored_cards.html",[],function(){return'	<h2>Stored Credit Cards</h2>\n	<img class="credit_card_images" src="/img/secure_card.png">\n\n	<div class="data-table">\n		<table border="0" cellspacing="0" cellpadding="0">\n		</table>\n	</div>'}),define("views/account/stored_cards_view",["backbone","handlebars","underscore","marionette","text!templates/account/stored_card_item.html","text!templates/account/stored_cards.html"],function(e,t,n,r,i,s){var o=e.Marionette.View.extend({template:t.compile(i),events:{"click a":"removeModel"},render:function(){return this.$el.html(this.template(this.model.toJSON())),console.log(this.model.toJSON()),this},removeModel:function(){this.model.destroy()}}),u=e.Marionette.CompositeView.extend({template:t.compile(s),itemView:o,itemViewContainer:"table",events:{},initialize:function(){this.render()}});return u}),define("views/account/credit_card_layout",["backbone","handlebars","underscore","marionette","text!templates/account/creditcard_layout.html","views/account/new_card_view","views/account/stored_cards_view"],function(e,t,n,r,i,s,o){var u=e.Marionette.Layout.extend({className:"clear white_background",attributes:{id:"content"},template:t.compile(i),regions:{storedCards:"#stored-cards",newCard:"#new-card"},initialize:function(){this.render()},onRender:function(){this.model.get("cards").fetch(),this.newCard.show(new s({user:this.model})),this.storedCards.show(new o({collection:this.model.get("cards")}))}});return u}),define("text!templates/account/bank_account_layout.html",[],function(){return'<div id="stored-accounts" class="stored_payment_methods"></div>\n<div id="new-account"></div>\n</div>'}),define("text!templates/account/new_bank_account_tpl.html",[],function(){return'<div class="notification_container account_notification_container hide"><p class="notification_text bank_account_saved"><i class="fa fa-check"></i> Bank account saved<p></div>\n<h2>Bank Account Details</h2>\n<img class="account_secure" src="/img/balanced_secured.png">\n<form action="" method="get" accept-charset="utf-8" class="check_image">\n  <fieldset>\n    <label for="pay-checking"><input type="radio" name="type" value="checking" id="pay-checking" checked> Checking Account</label>\n    <label for="pay-savings"><input type="radio" name="type" value="savings" id="pay-savings"> Savings Account</label>\n  </fieldset>\n  <fieldset>\n    <label for="">Name of Primary Account Holder</label>\n    <input type="text" name="name" placeholder="{{name}}" id="" size="50">\n    <label for="">Routing Number</label>\n    <input type="text" name="routing_number" value="" id="" size="50">\n    <label for="">Account Number</label>\n    <input type="text" name="account_number" value="" id="" size="50">\n  </fieldset>\n  <fieldset class="submit-buttons">\n    <a id="save-button" class="single">Save Bank Account</a>\n  </fieldset>\n</form>'}),define("views/account/new_bank_account_view",["jquery","backbone","handlebars","text!templates/account/new_bank_account_tpl.html"],function(e,t,n,r){var i=t.View.extend({template:n.compile(r),events:{"blur input":"updateFields","click #save-button":"saveBankAccount","change select":"updateFields"},initialize:function(e){this.user=e.user;if(this.user.get("firstName"))var t=this.user.attributes.firstName+" "+this.user.attributes.lastName;this.account={name:t,type:"checking"},console.log(this.user),this.render()},render:function(){return this.$el.html(this.template(this.account)),this},updateFields:function(t){this.account[t.target.name]=t.target.value,e(".notification_container").fadeOut("slow")},saveBankAccount:function(t){t.preventDefault();var n=this;balanced.bankAccount.create(this.account,function(t){if(t.status===201){delete t.data.id;var r=new n.user.attributes.bank_accounts.model(t.data);n.user.get("bank_accounts").add(r),r.save(),n.$("input").val(""),e(".notification_container").fadeOut("fast").fadeIn("slow"),n.account={type:"checking"}}else console.log(t)})}});return i}),define("text!templates/account/stored_bank_account_item.html",[],function(){return'<td>\n	<p>Routing Number: {{routing_number}} &mdash; Account Number: *********{{last_four_digits account_number}}</p>\n	<p class="remove"><a>Delete Bank Account</a></p>\n	{{#unless can_debit}}<p><a class="verify">Verify Bank Account</a></p>{{/unless}}\n</td>'}),define("text!templates/account/stored_bank_accounts.html",[],function(){return'<h2 class="secure">Stored Bank Accounts</h2>\n\n<div class="data-table">\n  <table border="0" cellspacing="0" cellpadding="0">\n  </table>\n</div>'}),define("views/ui-modules/modal",["backbone","handlebars"],function(e,t){var n='<div id="overlay" class="overlay hide"><div class="cover"></div><div id="panel" class="panel"><div class="close">X</div></div>',r=e.View.extend({attributes:{id:"popup_container"},template:n,holder:$("body"),initialize:function(e){this.view=e.view,this.listenTo(this.view,"hide",this.hide),this.listenTo(this.view,"close",this.remove),this.render()},render:function(e){this.$el.html(this.template),this.$("#panel").append(this.view.$el),this.holder.append(this.$el)},events:{"click .close":"hide","click .personal_message_link":"showPersonalMessage"},show:function(){this.$("#overlay").fadeIn("slow")},hide:function(e){this.$("#overlay").fadeOut("slow")},showPersonalMessage:function(){$(".panel").animate({left:"30%",width:"900px"},"fast"),$(".personal_message_helper").fadeOut("fast"),_.defer(function(){$(".personal_message_container").fadeIn("fast")})}});return r}),define("text!templates/account/verification.html",[],function(){return'<header class="bottom_divider pay_header_container">\n  <h2 class="pay_header">Please enter deposited amounts</h2>\n  <ul class="payment_select_container">\n    <li>\n      <label for="amount_1">Amount 1</label>\n      <input type="text" name="amount_1" value="">\n      <label for="amount_2">Amount 2</label>\n      <input type="text" name="amount_2" value="">\n    </li>\n  </ul>\n  <a id="verify-button" class="button action_button">Submit Verification</a>\n</header>'}),define("views/account/verification_modal",["backbone","handlebars","text!templates/account/verification.html"],function(e,t,n){var r=e.View.extend({template:t.compile(n),events:{"click #verify-button":"verify","blur input":"updateAmounts"},initialize:function(){this.amounts={},this.render()},render:function(){return this.$el.html(this.template()),this},updateAmounts:function(e){this.amounts[e.target.name]=parseFloat(e.target.value)},verify:function(e){var t=_.bind(function(e){console.log("callback"),this.trigger("hide")},this);this.model.verify(this.amounts,t)}});return r}),define("views/account/stored_bank_accounts_view",["backbone","handlebars","underscore","marionette","text!templates/account/stored_bank_account_item.html","text!templates/account/stored_bank_accounts.html","views/ui-modules/modal","views/account/verification_modal"],function(e,t,n,r,i,s,o,u){var a=e.Marionette.ItemView.extend({template:t.compile(i),events:{"click .remove":"removeModel","click .verify":"verify"},initialize:function(){this.listenTo(this.model,"change",this.render)},verify:function(){if(!this.modal){var e=new u({model:this.model});this.modal=new o({view:e})}this.modal.show()},removeModel:function(){this.model.destroy()}}),f=e.Marionette.CompositeView.extend({template:t.compile(s),itemView:a,itemViewContainer:"table",events:{},initialize:function(){this.render()}});return f}),define("views/account/bank_account_layout",["backbone","handlebars","underscore","marionette","text!templates/account/bank_account_layout.html","views/account/new_bank_account_view","views/account/stored_bank_accounts_view"],function(e,t,n,r,i,s,o){t.registerHelper("last_four_digits",function(e){if(!e)return;return e.slice(-4)});var u=e.Marionette.Layout.extend({className:"clear white_background",attributes:{id:"content"},template:t.compile(i),regions:{bankAccounts:"#stored-accounts",newBankAccount:"#new-account"},initialize:function(){this.render()},onRender:function(){this.model.get("bank_accounts").fetch(),this.newBankAccount.show(new s({user:this.model})),this.bankAccounts.show(new o({collection:this.model.get("bank_accounts")}))}});return u}),define("text!templates/account/password.html",[],function(){return'\n<h2>Change Your Password</h2>\n<div class="notification_container account_notification_container hide"><p class="notification_text password_saved"><i class="fa fa-check"></i> Password saved<p></div>\n\n<form action="" method="get" accept-charset="utf-8">\n  <fieldset>\n    <label for="">Current Password</label>\n    <input type="text" name="current-pw" value="" id="" size="50">\n    <label for="">New Password</label>\n    <input type="text" name="new-pw" value="" id="" size="50">\n    <label for="">Confirm New Password</label>\n    <input type="text" name="confirm-new-pw" value="" id="" size="50">\n  </fieldset>\n  <fieldset class="submit-buttons">\n    <a id="submit-button" class="single">Save New Password</a>\n  </fieldset>\n</form>\n\n</div>'}),define("views/account/password_view",["backbone","handlebars","text!templates/account/password.html"],function(e,t,n){var r=e.View.extend({className:"clear white_background",attributes:{id:"content"},template:t.compile(n),events:{"click #submit-button":"save","blur input":"updatePassword"},initialize:function(){this.render(),this.passwords={}},render:function(){return this.$el.html(this.template()),this},save:function(e){this.passwords["new-pw"]===this.passwords["confirm-new-pw"]&&(this.model.set("newPassword",this.passwords["new-pw"]),this.model.set("currentPassword",this.passwords["current-pw"]),this.model.save({},{success:_.bind(function(e,t){this.$("input").val(""),$(".notification_container").fadeIn("slow")},this)}))},updatePassword:function(e){this.passwords[e.target.name]=e.target.value,$(".notification_container").fadeOut("fast").fadeOut("slow")}});return r}),function(e){var t,n,r;typeof window=="undefined"?(t=require("underscore"),n=require("backbone"),r=n,typeof module=="undefined"||(module.exports=r)):(t=window._,n=window.Backbone,r=window),n.Relational={showWarnings:!0},n.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(this._permitsUsed===0)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},n.BlockingQueue=function(){this._queue=[]},t.extend(n.BlockingQueue.prototype,n.Semaphore,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;this._queue=[];while(e&&e.length)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),n.Relational.eventQueue=new n.BlockingQueue,n.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[r]},t.extend(n.Store.prototype,n.Events,{initializeRelation:function(e,r,i){var s=t.isString(r.type)?n[r.type]||this.getObjectByName(r.type):r.type;s&&s.prototype instanceof n.Relation?new s(e,r,i):n.Relational.showWarnings&&typeof console!="undefined"&&console.warn("Relation=%o; missing or invalid relation type!",r)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=t.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){t.find(this._subModels,function(n){return t.find(n.subModels||[],function(t,r){var i=this.getObjectByName(t);if(e===i)return n.superModelType._subModels[r]=e,e._superModel=n.superModelType,e._subModelTypeValue=r,e._subModelTypeAttribute=n.superModelType.prototype.subModelTypeAttribute,!0},this)},this)},addReverseRelation:function(e){var n=t.any(this._reverseRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var n=t.any(this._orphanRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){t.each(this._orphanRelations.slice(0),function(e){var r=n.Relational.store.getObjectByName(e.relatedModel);r&&(this.initializeRelation(null,e),this._orphanRelations=t.without(this._orphanRelations,e))},this)},_addRelation:function(e,n){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(n),t.each(e._subModels||[],function(e){this._addRelation(e,n)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){if(!(t instanceof e.model))return;new e.type(t,e)},this)},getCollection:function(e,r){e instanceof n.RelationalModel&&(e=e.constructor);var i=e;while(i._superModel)i=i._superModel;var s=t.find(this._collections,function(e){return e.model===i});return!s&&r!==!1&&(s=this._createCollection(i)),s},getObjectByName:function(n){var r=n.split("."),i=null;return t.find(this._modelScopes,function(n){i=t.reduce(r||[],function(t,n){return t?t[n]:e},n);if(i&&i!==n)return!0},this),i},_createCollection:function(e){var t;return e instanceof n.RelationalModel&&(e=e.constructor),e.prototype instanceof n.RelationalModel&&(t=new n.Collection,t.model=e,this._collections.push(t)),t},resolveIdForItem:function(e,r){var i=t.isString(r)||t.isNumber(r)?r:null;return i===null&&(r instanceof n.RelationalModel?i=r.id:t.isObject(r)&&(i=r[e.prototype.idAttribute])),!i&&i!==0&&(i=null),i},find:function(e,t){var n=this.resolveIdForItem(e,t),r=this.getCollection(e);if(r){var i=r.get(n);if(i instanceof e)return i}return null},register:function(e){var t=this.getCollection(e);if(t){var n=e.collection;t.add(e),this.listenTo(e,"destroy",this.unregister,this),this.listenTo(e,"relational:unregister",this.unregister,this),e.collection=n}},checkId:function(e,t){var r=this.getCollection(e),i=r&&r.get(t);if(i&&e!==i)throw n.Relational.showWarnings&&typeof console!="undefined"&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",i,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e,t,n){this.stopListening(e);var r=this.getCollection(e);r&&r.remove(e,n)},reset:function(){this.stopListening(),this._collections=[],this._subModels=[],this._modelScopes=[r]}}),n.Relational.store=new n.Store,n.Relation=function(e,r,i){this.instance=e,r=t.isObject(r)?r:{},this.reverseRelation=t.defaults(r.reverseRelation||{},this.options.reverseRelation),this.options=t.defaults(r,this.options,n.Relation.prototype.options),this.reverseRelation.type=t.isString(this.reverseRelation.type)?n[this.reverseRelation.type]||n.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,t.isFunction(this.relatedModel)&&!(this.relatedModel.prototype instanceof n.RelationalModel)&&(this.relatedModel=t.result(this,"relatedModel")),t.isString(this.relatedModel)&&(this.relatedModel=n.Relational.store.getObjectByName(this.relatedModel));if(!this.checkPreconditions())return;!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&n.Relational.store.addReverseRelation(t.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation));if(e){var s=this.keySource;s!==this.key&&typeof this.instance.get(this.key)=="object"&&(s=this.key),this.setKeyContents(this.instance.get(s)),this.relatedCollection=n.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(i),this.options.autoFetch&&this.instance.fetchRelated(this.key,t.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},n.Relation.extend=n.Model.extend,t.extend(n.Relation.prototype,n.Events,n.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,r=this.key,i=this.model,s=this.relatedModel,o=n.Relational.showWarnings&&typeof console!="undefined";if(!i||!r||!s)return o&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,i,r,s),!1;if(i.prototype instanceof n.RelationalModel){if(s.prototype instanceof n.RelationalModel){if(this instanceof n.HasMany&&this.reverseRelation.type===n.HasMany)return o&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&t.keys(e._relations).length){var u=t.find(e._relations,function(e){return e.key===r},this);if(u)return o&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,r,e,u),!1}return!0}return o&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,s),!1}return o&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1},setRelated:function(e){this.related=e,this.instance.acquire(),this.instance.attributes[this.key]=e,this.instance.release()},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){var n=[],r=t.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e];return t.each(r||[],function(e){t.each(e.getRelations()||[],function(e){this._isReverseRelation(e)&&n.push(e)},this)},this),n},destroy:function(){this.stopListening(),this instanceof n.HasOne?this.setRelated(null):this instanceof n.HasMany&&this.setRelated(this._prepareCollection()),t.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),n.HasOne=n.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var n=this.findRelated(e);this.setRelated(n),t.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var n=null;e=t.defaults({parse:this.options.parse},e);if(this.keyContents instanceof this.relatedModel)n=this.keyContents;else if(this.keyContents||this.keyContents===0){var r=t.defaults({create:this.options.createModels},e);n=this.relatedModel.findOrCreate(this.keyContents,r)}return this.related&&(this.keyId=null),n},setKeyContents:function(e){this.keyContents=e,this.keyId=n.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,r,i){if(this.isLocked())return;this.acquire(),i=i?t.clone(i):{};var s=t.isUndefined(i.__related),o=s?this.related:i.__related;if(s){this.setKeyContents(r);var u=this.findRelated(i);this.setRelated(u)}o&&this.related!==o&&t.each(this.getReverseRelations(o),function(e){e.removeRelated(this.instance,null,i)},this),t.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,i)},this);if(!i.silent&&this.related!==o){var a=this;this.changed=!0,n.Relational.eventQueue.add(function(){a.instance.trigger("change:"+a.key,a.instance,a.related,i,!0),a.changed=!1})}this.release()},tryAddRelated:function(e,t,n){(this.keyId||this.keyId===0)&&e.id===this.keyId&&(this.addRelated(e,n),this.keyId=null)},addRelated:function(e,n){var r=this;e.queue(function(){if(e!==r.related){var i=r.related||null;r.setRelated(e),r.onChange(r.instance,e,t.defaults({__related:i},n))}})},removeRelated:function(e,n,r){if(!this.related)return;if(e===this.related){var i=this.related||null;this.setRelated(null),this.onChange(this.instance,e,t.defaults({__related:i},r))}}}),n.HasMany=n.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:n.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,t.isFunction(this.collectionType)&&this.collectionType!==n.Collection&&!(this.collectionType.prototype instanceof n.Collection)&&(this.collectionType=t.result(this,"collectionType")),t.isString(this.collectionType)&&(this.collectionType=n.Relational.store.getObjectByName(this.collectionType));if(!(this.collectionType===n.Collection||this.collectionType.prototype instanceof n.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var r=this.findRelated(e);this.setRelated(r)},_prepareCollection:function(e){this.related&&this.stopListening(this.related);if(!e||!(e instanceof n.Collection)){var r=t.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,r)}e.model=this.relatedModel;if(this.options.collectionKey){var i=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[i]&&e[i]!==this.instance?n.Relational.showWarnings&&typeof console!="undefined"&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,i,this.options.collectionKey):i&&(e[i]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var r=null;e=t.defaults({parse:this.options.parse},e);if(this.keyContents instanceof n.Collection)this._prepareCollection(this.keyContents),r=this.keyContents;else{var i=[];t.each(this.keyContents,function(n){if(n instanceof this.relatedModel)var r=n;else r=this.relatedModel.findOrCreate(n,t.extend({merge:!0},e,{create:this.options.createModels}));r&&i.push(r)},this),this.related instanceof n.Collection?r=this.related:r=this._prepareCollection(),r.set(i,t.defaults({merge:!1,parse:!1},e))}return this.keyIds=t.difference(this.keyIds,t.pluck(r.models,"id")),r},setKeyContents:function(e){this.keyContents=e instanceof n.Collection?e:null,this.keyIds=[],!this.keyContents&&(e||e===0)&&(this.keyContents=t.isArray(e)?e:[e],t.each(this.keyContents,function(e){var t=n.Relational.store.resolveIdForItem(this.relatedModel,e);(t||t===0)&&this.keyIds.push(t)},this))},onChange:function(e,r,i){i=i?t.clone(i):{},this.setKeyContents(r),this.changed=!1;var s=this.findRelated(i);this.setRelated(s);if(!i.silent){var o=this;n.Relational.eventQueue.add(function(){o.changed&&(o.instance.trigger("change:"+o.key,o.instance,o.related,i,!0),o.changed=!1)})}},handleAddition:function(e,r,i){i=i?t.clone(i):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,i)},this);var s=this;!i.silent&&n.Relational.eventQueue.add(function(){s.instance.trigger("add:"+s.key,e,s.related,i)})},handleRemoval:function(e,r,i){i=i?t.clone(i):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,i)},this);var s=this;!i.silent&&n.Relational.eventQueue.add(function(){s.instance.trigger("remove:"+s.key,e,s.related,i)})},handleReset:function(e,r){var i=this;r=r?t.clone(r):{},!r.silent&&n.Relational.eventQueue.add(function(){i.instance.trigger("reset:"+i.key,i.related,r)})},tryAddRelated:function(e,n,r){var i=t.contains(this.keyIds,e.id);i&&(this.addRelated(e,r),this.keyIds=t.without(this.keyIds,e.id))},addRelated:function(e,n){var r=this;e.queue(function(){r.related&&!r.related.get(e)&&r.related.add(e,t.defaults({parse:!1},n))})},removeRelated:function(e,t,n){this.related.get(e)&&this.related.remove(e,n)}}),n.RelationalModel=n.Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,r){if(r&&r.collection){var i=this,s=this.collection=r.collection;delete r.collection,this._deferProcessing=!0;var o=function(e){e===i&&(i._deferProcessing=!1,i.processQueue(),s.off("relational:add",o))};s.on("relational:add",o),t.defer(function(){o(i)})}n.Relational.store.processOrphanRelations(),this._queue=new n.BlockingQueue,this._queue.block(),n.Relational.eventQueue.block();try{n.Model.apply(this,arguments)}finally{n.Relational.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&e.indexOf("change")===0){var t=this,r=arguments;n.Relational.eventQueue.add(function(){if(!t._isInitialized)return;var i=!0;if(e==="change")i=t.hasChanged()||t._attributeChangeFired,t._attributeChangeFired=!1;else{var s=e.slice(7),o=t.getRelation(s);o?(i=r[4]===!0,i?t.changed[s]=r[2]:o.changed||delete t.changed[s]):i&&(t._attributeChangeFired=!0)}i&&n.Model.prototype.trigger.apply(t,r)})}else n.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},t.each(t.result(this,"relations")||[],function(t){n.Relational.store.initializeRelation(this,t,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e){this._isInitialized&&!this.isLocked()&&t.each(this._relations,function(t){var n=this.attributes[t.keySource]||this.attributes[t.key];t.related!==n&&this.trigger("relational:change:"+t.key,this,n,e||{}),t.keySource!==t.key&&delete t.instance.attributes[t.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return t.values(this._relations)},fetchRelated:function(e,r,i){r=t.extend({update:!0,remove:!1},r);var s,o=[],u=this.getRelation(e),a=u&&(u.keyIds&&u.keyIds.slice(0)||(u.keyId||u.keyId===0?[u.keyId]:[]));if(i){var f=u.related instanceof n.Collection?u.related.models:[u.related];t.each(f,function(e){(e.id||e.id===0)&&a.push(e.id)})}if(a&&a.length){var l=[],f=t.map(a,function(e){var t=n.Relational.store.find(u.relatedModel,e);if(!t){var i={};i[u.relatedModel.prototype.idAttribute]=e,t=u.relatedModel.findOrCreate(i,r),l.push(t)}return t},this);u.related instanceof n.Collection&&t.isFunction(u.related.url)&&(s=u.related.url(f));if(s&&s!==u.related.url()){var c=t.defaults({error:function(){var e=arguments;t.each(l,function(t){t.trigger("destroy",t,t.collection,r),r.error&&r.error.apply(t,e)})},url:s},r);o=[u.related.fetch(c)]}else o=t.map(f,function(e){var n=t.defaults({error:function(){t.contains(l,e)&&(e.trigger("destroy",e,e.collection,r),r.error&&r.error.apply(e,arguments))}},r);return e.fetch(n)},this)}return o},get:function(r){var i=n.Model.prototype.get.call(this,r);if(!this.dotNotation||r.indexOf(".")===-1)return i;var s=r.split("."),o=t.reduce(s,function(r,i){if(t.isNull(r)||t.isUndefined(r))return e;if(r instanceof n.Model)return n.Model.prototype.get.call(r,i);if(r instanceof n.Collection)return n.Collection.prototype.at.call(r,i);throw new Error("Attribute must be an instanceof Backbone.Model or Backbone.Collection. Is: "+r+", currentSplit: "+i)},this);if(i!==e&&o!==e)throw new Error("Ambiguous result for '"+r+"'. direct result: "+i+", dotNotation: "+o);return i||o},set:function(e,r,i){n.Relational.eventQueue.block();var s;t.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r);try{var o=this.id,u=s&&this.idAttribute in s&&s[this.idAttribute];n.Relational.store.checkId(this,u);var a=n.Model.prototype.set.apply(this,arguments);!this._isInitialized&&!this.isLocked()?(this.constructor.initializeModelHierarchy(),n.Relational.store.register(this),this.initializeRelations(i)):u&&u!==o&&n.Relational.store.update(this),s&&this.updateRelations(i)}finally{n.Relational.eventQueue.unblock()}return a},clone:function(){var e=t.clone(this.attributes);return t.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),t.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var r=n.Model.prototype.toJSON.call(this,e);return this.constructor._superModel&&!(this.constructor._subModelTypeAttribute in r)&&(r[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),t.each(this._relations,function(i){var s=r[i.key],o=i.options.includeInJSON,u=null;o===!0?s&&t.isFunction(s.toJSON)&&(u=s.toJSON(e)):t.isString(o)?(s instanceof n.Collection?u=s.pluck(o):s instanceof n.Model&&(u=s.get(o)),o===i.relatedModel.prototype.idAttribute&&(i instanceof n.HasMany?u=u.concat(i.keyIds):i instanceof n.HasOne&&(u=u||i.keyId))):t.isArray(o)?s instanceof n.Collection?(u=[],s.each(function(e){var n={};t.each(o,function(t){n[t]=e.get(t)}),u.push(n)})):s instanceof n.Model&&(u={},t.each(o,function(e){u[e]=s.get(e)})):delete r[i.key],o&&(r[i.keyDestination]=u),i.keyDestination!==i.key&&delete r[i.key]}),this.release(),r}},{setup:function(e){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?n.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,t.each(this.prototype.relations||[],function(e){e.model||(e.model=this);if(e.reverseRelation&&e.model===this){var r=!0;if(t.isString(e.relatedModel)){var i=n.Relational.store.getObjectByName(e.relatedModel);r=i&&i.prototype instanceof n.RelationalModel}r?n.Relational.store.initializeRelation(null,e):t.isString(e.relatedModel)&&n.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var n=this._findSubModelType(this,e)||this;return new n(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var n=t[e.prototype.subModelTypeAttribute],r=e._subModels[n];if(r)return r;for(n in e._subModels){r=this._findSubModelType(e._subModels[n],t);if(r)return r}}return null},initializeModelHierarchy:function(){this.inheritRelations();if(this.prototype.subModelTypes){var e=t.keys(this._subModels),r=t.omit(this.prototype.subModelTypes,e);t.each(r,function(e){var t=n.Relational.store.getObjectByName(e);t&&t.initializeModelHierarchy()})}},inheritRelations:function(){if(!t.isUndefined(this._superModel)&&!t.isNull(this._superModel))return;n.Relational.store.setupSuperModel(this);if(this._superModel){this._superModel.inheritRelations();if(this._superModel.prototype.relations){var e=t.select(this._superModel.prototype.relations||[],function(e){return!t.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,r){r||(r={});var i=t.isObject(e)&&r.parse&&this.prototype.parse?this.prototype.parse(t.clone(e)):e,s=n.Relational.store.find(this,i);return t.isObject(e)&&(s&&r.merge!==!1?(delete r.collection,delete r.url,s.set(i,r)):!s&&r.create!==!1&&(s=this.build(e,r))),s},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)}}),t.extend(n.RelationalModel.prototype,n.Semaphore),n.Collection.prototype.__prepareModel=n.Collection.prototype._prepareModel,n.Collection.prototype._prepareModel=function(e,t){var r;return e instanceof n.Model?(e.collection||(e.collection=this),r=e):(t||(t={}),t.collection=this,typeof this.model.findOrCreate!="undefined"?r=this.model.findOrCreate(e,t):r=new this.model(e,t),r&&r.isNew()&&!r._validate(e,t)&&(this.trigger("invalid",this,e,t),r=!1)),r};var i=n.Collection.prototype.__set=n.Collection.prototype.set;n.Collection.prototype.set=function(e,r){if(this.model.prototype instanceof n.RelationalModel){r&&r.parse&&(e=this.parse(e,r)),t.isArray(e)||(e=e?[e]:[]);var s=[],o=[];return t.each(e,function(e){e instanceof n.Model||(e=n.Collection.prototype._prepareModel.call(this,e,r)),e&&(o.push(e),!this.get(e)&&!this.get(e.cid)?s.push(e):e.id!=null&&(this._byId[e.id]=e))},this),i.call(this,o,t.defaults({parse:!1},r)),t.each(s,function(e){(this.get(e)||this.get(e.cid))&&this.trigger("relational:add",e,this,r)},this),this}return i.apply(this,arguments)};var s=n.Collection.prototype.__remove=n.Collection.prototype.remove;n.Collection.prototype.remove=function(e,r){if(this.model.prototype instanceof n.RelationalModel){e=t.isArray(e)?e.slice(0):[e],r||(r={});var i=[];return t.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&i.push(e)},this),i.length&&(s.call(this,i,r),t.each(i,function(e){this.trigger("relational:remove",e,this,r)},this)),this}return s.apply(this,arguments)};var o=n.Collection.prototype.__reset=n.Collection.prototype.reset;n.Collection.prototype.reset=function(e,r){return r=t.extend({merge:!0},r),o.call(this,e,r),this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,r),this};var u=n.Collection.prototype.__sort=n.Collection.prototype.sort;n.Collection.prototype.sort=function(e){return u.call(this,e),this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,e),this};var a=n.Collection.prototype.__trigger=n.Collection.prototype.trigger;n.Collection.prototype.trigger=function(e){if(this.model.prototype instanceof n.RelationalModel){if(e==="add"||e==="remove"||e==="reset"||e==="sort"){var r=this,i=arguments;t.isObject(i[3])&&(i=t.toArray(i),i[3]=t.clone(i[3])),n.Relational.eventQueue.add(function(){a.apply(r,i)})}else a.apply(this,arguments);return this}return a.apply(this,arguments)},n.RelationalModel.extend=function(e,t){var r=n.Model.extend.apply(this,arguments);return r.setup(this),r}}(),define("backbone-relational",["backbone"],function(){}),define("models/comment",["backbone","backbone-relational","moment"],function(e,t,n){var r=e.RelationalModel.extend({url:function(){return"/agreement/"+this.collection.agreement.get("agreementID")+"/comments"},set:function(t,r,i){e.RelationalModel.prototype.set.apply(this,arguments),typeof t=="object"?_.has(t,"dateCreated")&&(this.attributes.dateCreated=n(t.dateCreated)):t==="dateCreated"&&(this.attributes.dateCreated=n(r))}});return r}),define("collections/cards",["backbone","models/comment"],function(e,t){var n=e.Collection.extend({model:t,url:function(){return"/user/"+this.user.id+"/cards"}});return n}),define("models/card",["backbone","backbone-relational"],function(e,t){var n=e.RelationalModel.extend({urlRoot:function(){return"/user/"+this.collection.user.id+"/cards"}});return n}),define("collections/bank_accounts",["backbone","models/comment"],function(e,t){var n=e.Collection.extend({model:t,url:function(){return"/user/"+this.user.id+"/bank_account"}});return n}),define("models/bank_account",["backbone","backbone-relational"],function(e,t){var n=e.RelationalModel.extend({urlRoot:function(){return"/user/"+this.collection.user.id+"/bank_account"},verify:function(e,t){$.ajax({type:"POST",url:this.url()+"/verify",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:_.bind(function(e){this.set("can_debit",!0),t(e)},this)})}});return n}),define("models/user",["backbone","collections/cards","models/card","collections/bank_accounts","models/bank_account"],function(e,t,n,r,i){var s=e.RelationalModel.extend({relations:[{type:e.HasMany,key:"cards",relatedModel:n,collectionType:t,reverseRelation:{key:"user",includeInJSON:!1}},{type:e.HasMany,key:"bank_accounts",relatedModel:i,collectionType:r,reverseRelation:{key:"user",includeInJSON:!1}}],url:function(){return this.id?"/user/"+this.id:"/user"}});return s}),define("app/routers/account_router",["backbone","parsley","views/account/main_container_view","views/account/personal_view","views/account/credit_card_layout","views/account/bank_account_layout","views/account/password_view","models/user"],function(e,t,n,r,i,s,o,u){var a=e.Router.extend({routes:{"":"personal",personal:"personal",password:"password",creditcard:"creditCard",bankaccount:"bankAccount"},initialize:function(){this.mainContainer=new n({router:this}),this.model=new u(window.thisUser),this.model.set("cards",window.cards),this.model.set("bank_accounts",window.bank_account)},personal:function(){this.personalView||(this.personalView=new r({model:this.model})),this.mainContainer.switchToView(this.personalView),this.mainContainer.switchTab($("#personal")),$(".account_personal_form").parsley()},password:function(){this.passwordView||(this.passwordView=new o({model:this.model})),this.mainContainer.switchToView(this.passwordView),this.mainContainer.switchTab($("#password"))},creditCard:function(){this.creditCardView||(this.creditCardView=new i({model:this.model})),this.mainContainer.switchToView(this.creditCardView),this.mainContainer.switchTab($("#creditcard"))},bankAccount:function(){this.bankAccountView||(this.bankAccountView=new s({model:this.model})),this.mainContainer.switchToView(this.bankAccountView),this.mainContainer.switchTab($("#bankaccount"))}});return a}),define("app/mainaccount",["require","app/routers/account_router"],function(e){balanced.init("/v1/marketplaces/TEST-MP1f775iSL82BucxjmR83cOk");var t=e("app/routers/account_router");$(function(){var e=new t;Backbone.history.start({pushState:!1})})});