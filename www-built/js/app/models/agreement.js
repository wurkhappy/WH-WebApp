define(["backbone","backbone-relational","models/payment","collections/payments","models/status","collections/status","models/comment","collections/comments","collections/clauses","models/clause"],function(e,t,n,r,i,s,o,u,a,f){var l=e.RelationalModel.extend({relations:[{type:e.HasMany,key:"payments",relatedModel:n,collectionType:r,reverseRelation:{key:"parent",includeInJSON:!1}},{type:e.HasMany,key:"statusHistory",relatedModel:i,collectionType:s,reverseRelation:{key:"ownerModel",includeInJSON:!1}},{type:e.HasOne,key:"currentStatus",relatedModel:i,reverseRelation:{includeInJSON:!1}},{type:e.HasMany,key:"comments",relatedModel:o,collectionType:u,includeInJSON:!1,reverseRelation:{key:"agreement",includeInJSON:!1}},{type:e.HasMany,key:"clauses",relatedModel:f,collectionType:a,includeInJSON:!0}],idAttribute:"versionID",urlRoot:function(){return"/agreement/v"},submit:function(e,t){this.updateStatus("submitted",e,t)},accept:function(e,t){this.updateStatus("accepted",e,t)},reject:function(e,t){this.updateStatus("rejected",e,t)},updateStatus:function(e,t,n){$.ajax({type:"POST",url:"/agreement/v/"+this.id+"/status",contentType:"application/json",dataType:"json",data:JSON.stringify({action:e,message:t,versionlessID:this.get("versionlessID")}),success:_.bind(function(e){this.set("currentStatus",e),_.isFunction(n)&&n()},this)})}});return l});