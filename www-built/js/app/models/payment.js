define(["backbone","backbone-relational","models/scope_item","collections/scope_items","models/status","collections/status"],function(e,t,n,r,i,s){var o=e.RelationalModel.extend({relations:[{type:e.HasMany,key:"scopeItems",relatedModel:n,collectionType:r},{type:e.HasOne,key:"currentStatus",relatedModel:i,collectionType:s}],urlRoot:function(){return"/agreement/v/"+this.collection.parent.id+"/payment"},set:function(t,n,r){e.RelationalModel.prototype.set.apply(this,arguments),typeof t=="object"?(_.has(t,"amount")&&(this.attributes.amount=parseFloat(t.amount)),_.has(t,"dateExpected")&&(this.attributes.dateExpected=moment(t.dateExpected))):t==="amount"?this.attributes.amount=parseFloat(n):t==="dateExpected"&&(this.attributes.dateExpected=moment(n))},submit:function(e,t){this.updateStatus({action:"submitted",creditSourceURI:e},t)},accept:function(e){this.updateStatus({action:"accepted",debitSourceURI:e})},reject:function(e){this.updateStatus({action:"rejected",message:e})},updateStatus:function(e,t){$.ajax({type:"POST",url:"/agreement/v/"+this.collection.parent.id+"/payment/"+this.id+"/status",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:_.bind(function(e){this.collection.parent.set("currentStatus",e),this.set("currentStatus",this.collection.parent.get("currentStatus")),t()},this)})},isDeposit:function(){if(this.get("title")==="Deposit")return!0}});return o});