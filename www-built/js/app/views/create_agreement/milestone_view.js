define(["backbone","handlebars","underscore","kalendae","text!templates/create_agreement/milestone_tpl.html","views/create_agreement/payment_scope_view"],function(e,t,n,r,i,s){t.registerHelper("dateFormat",function(e){return e.format("MMM D, YYYY")});var o=e.View.extend({tagName:"div",className:"bottom_divider hide",template:t.compile(i),initialize:function(e){this.router=e.router,this.render()},render:function(){var e=this.model.isDeposit();this.$el.html(this.template({model:this.model.toJSON(),deposit:e}));var t=new s({model:this.model,collection:this.model.get("scopeItems"),deposit:e});return t.render(),t.$el.insertBefore(this.$(".removeButton")),this.$el.fadeIn("slow"),this},events:{"blur input":"updateFields","blur .paymentAmount":"updateAmount","blur #require_checkbox":"requireDeposit","focus .kal":"triggerCalender","click .remove_icon > a":"removeModel"},updateAmount:function(e){this.model.set(e.target.name,parseFloat(e.target.value))},updateFields:function(e){if(!e.target.name)return;this.model.set(e.target.name,e.target.value)},requireDeposit:function(e){if(!e.target.name)return;e.target.value==="true"&&this.model.set(e.target.name,!0)},triggerCalender:function(e){this.calendar||(this.calendar=new r.Input(this.$(".kal")[0],{}),this.calendar.subscribe("date-clicked",n.bind(this.setDate,this)))},setDate:function(e,t){this.model.set("dateExpected",e),n.delay(this.closeCalendar,150),this.$(".kal").val(e.format("MM/DD/YYYY")),this.$(".kal").blur()},closeCalendar:function(){$(".kalendae").hide()},removeModel:function(e){var t=this;t.$el.fadeOut("fast"),n.delay(function(){t.model.collection.remove(t.model)},1e3)}});return o});