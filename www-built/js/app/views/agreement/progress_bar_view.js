define(["jquery","backbone","handlebars","underscore","marionette","jquery-ui","text!templates/agreement/agreement_progress_bar_tpl.html"],function(e,t,n,r,i,s,o){n.registerHelper("adjustIconColor",function(e){return e==="submitted"?"yellow_progress":e==="accepted"?"green_progress":e==="rejected"?"red_progress":"grey_progress"}),n.registerHelper("midpoint",function(e,t){var n=t.payments.length;return n%2!=0||e!=n/2&&e!=n-.5?"":'<i class="fa fa-circle progress_icon" style="opacity:0;"></i>'});var u=t.View.extend({template:n.compile(o),initialize:function(e){this.payments=e.model.get("payments"),this.listenTo(this.payments,"change",this.render)},events:{"mouseover .progress_icon":"hoverPayment","mouseleave .progress_icon":"unhoverPayment"},render:function(){var e=this.payments,t=e.getNumberOfSubmittedPayments(),n=e.getAcceptedPayments(),r=t+n,i=this.payments.length,s=this.calculatePercentage(i,r);return this.$el.html(this.template({payments:this.payments.toJSON(),percentComplete:s})),this.afterRender(),this},afterRender:function(){var t=30,n=this.payments,i=n.length,s=i%2==0?3:2,o=(i+s-1)*t;r.defer(function(){var n=900-o,r=e(".progress_icon"),u=n/(i+s-1);e(".progress_icon").css({"margin-left":u/2+"px","margin-right":u/2+"px"}),e(".progress_icon").first().css("margin-left",-(t/2)+"px"),e(".progress_icon").last().css("margin-right","0px"),e("progress").addClass("yellow_progress")})},calculatePercentage:function(e,t){var n=100,r=e%2==0?3:2,i=e+r-1;return t<1?0:t===e?100:n/i*t},hoverPayment:function(t){var n=e(t.target).data("paymentid");if(n){var r="",i=this.model.get("statusHistory").filterByPaymentID(n);i.each(function(e){var t=e.get("action");r+="<li>"+t.charAt(0).toUpperCase()+t.slice(1)+" on "+e.get("date").format("MMM DD, YYYY")+"</li>"}),i.length===0&&(r="No actions taken yet"),e(t.target).html('<div class="tooltip" style="position: absolute;"><ul>'+r+"</ul></div>")}},unhoverPayment:function(t){e(t.target).empty(),e(t.target).remove("div")}});return u});